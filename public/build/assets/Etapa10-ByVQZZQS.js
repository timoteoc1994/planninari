import{k as x,x as D,d as S,c as C,o as n,w as _,a as t,j,e as c,f,u as d,t as p,F as b,h as v}from"./app-CMmN75Yt.js";import{s as g}from"./index-sFwGSaal.js";import{S as l}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as B}from"./AppLayout-CYw2QiOb.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const N={class:"font-semibold text-xl text-gray-800 leading-tight"},F={class:"py-12"},G={class:"max-w-4xl mx-auto sm:px-6 lg:px-8 bg-white p-8 rounded shadow"},z={class:"w-full bg-gray-100 p-6 rounded mb-4"},A=["disabled"],O={key:0,class:"mt-2 text-sm text-red-600"},P={key:1,class:"mt-3 list-disc list-inside text-sm text-green-600"},T={key:2,class:"mt-4"},$={class:"list-disc list-inside text-sm text-gray-700"},J=["href"],L=["onClick","disabled"],V=["disabled"],Q={__name:"Etapa10",props:{etapa10:Object,proyecto_id:Number},setup(y){const s=y,i=x(()=>!!(s.etapa10&&s.etapa10.id)),e=D({proyecto_id:s.proyecto_id,documentos:[]}),m=S([]),h=x(()=>{if(!s.etapa10||!s.etapa10.document_paths)return[];try{return JSON.parse(s.etapa10.document_paths)}catch{return[]}});function w(u){const o=Array.from(u.target.files),a=["application/pdf","application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","image/jpeg","image/png"];e.documentos=[],m.value=[],o.forEach(r=>{if(!a.includes(r.type)){l.fire("Tipo no válido","Solo PDF, Word, Excel, JPG y PNG.","warning");return}e.documentos.push(r),m.value.push(r.name)})}function E(){if(!i.value&&e.documentos.length===0){l.fire("Campo requerido","Debes seleccionar al menos un documento.","warning");return}const u=i.value?g("etapa10.update",s.etapa10.id):g("etapa10.store");e.post(u,{forceFormData:!0,preserveScroll:!0,onSuccess:()=>{l.fire("Listo",i.value?"Etapa 10 actualizada correctamente.":"Documentos guardados correctamente.","success"),m.value=[],e.documentos=[]},onError:o=>{console.error(o),l.fire("Error",Object.values(o).join("<br>"),"error")}})}function k(u){l.fire({title:"¿Eliminar documento?",text:"Este documento se borrará permanentemente.",icon:"warning",showCancelButton:!0,confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"}).then(o=>{o.isConfirmed&&e.delete(g("etapa10.destroyDocument",[s.etapa10.id,u]),{preserveScroll:!0,onSuccess:()=>{l.fire("Eliminado","Documento eliminado correctamente.","success")},onError:a=>{console.error(a),l.fire("Error","No se pudo eliminar el documento.","error")}})})}return(u,o)=>(n(),C(B,{title:"Etapa 10"},{header:_(()=>[t("h2",N," Etapa 10 – "+p(i.value?"Editar":"Subir")+" Documentos Necesarios ",1)]),default:_(()=>[t("div",F,[t("div",G,[t("form",{onSubmit:j(E,["prevent"]),enctype:"multipart/form-data"},[t("div",z,[o[1]||(o[1]=t("p",{class:"text-lg font-semibold mb-2"},"Documentos necesarios",-1)),t("input",{type:"file",name:"documentos",accept:".pdf,.doc,.docx,.xlsx,.jpg,.jpeg,.png",multiple:"",onChange:w,disabled:d(e).processing,class:"block w-full text-sm text-gray-700"},null,40,A),d(e).errors.documentos?(n(),c("p",O,p(d(e).errors.documentos),1)):f("",!0),m.value.length?(n(),c("ul",P,[(n(!0),c(b,null,v(m.value,(a,r)=>(n(),c("li",{key:r},p(a),1))),128))])):f("",!0),i.value&&h.value.length?(n(),c("div",T,[o[0]||(o[0]=t("p",{class:"text-sm text-gray-600 mb-2"},"Documentos actuales:",-1)),t("ul",$,[(n(!0),c(b,null,v(h.value,(a,r)=>(n(),c("li",{key:r,class:"flex items-center justify-between"},[t("a",{href:`/storage/${a}`,target:"_blank",class:"underline text-blue-600 mr-4"},p(a.split("/").pop()),9,J),t("button",{type:"button",onClick:q=>k(r),class:"text-red-600 hover:underline",disabled:d(e).processing}," Eliminar ",8,L)]))),128))])])):f("",!0)]),t("button",{type:"submit",class:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:opacity-50",disabled:d(e).processing},p(d(e).processing?i.value?"Actualizando...":"Guardando...":i.value?"Actualizar":"Guardar"),9,V)],32)])])]),_:1}))}};export{Q as default};
