import{d as x,k as M,x as P,c as D,o as m,w as F,a as t,e as v,f as G,l as _,p as V,F as N,h as S,t as n,u as a,j as U,q as z,Q as E}from"./app-dG6Nd7Y9.js";import{_ as Q}from"./AppLayout-Da1CQfCP.js";import{S as A}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";const H={class:"py-8 max-w-6xl mx-auto space-y-6"},J={class:"flex items-center gap-4"},K={class:"overflow-x-auto"},W={class:"w-full table-auto border-collapse bg-white rounded shadow"},X={class:"px-4 py-2"},Z={class:"px-4 py-2"},tt={class:"px-4 py-2"},et={class:"px-4 py-2"},ot={class:"px-4 py-2"},st={class:"px-4 py-2"},lt={class:"px-4 py-2"},nt={class:"px-4 py-2"},at={class:"px-4 py-2"},rt={class:"px-4 py-2"},dt={class:"px-4 py-2"},it={class:"flex space-x-2"},ut=["onClick"],ct=["onClick"],pt={class:"font-semibold bg-gray-50 border-t"},mt={class:"max-w-6xl mx-auto py-10"},bt={class:"w-full table-auto border-collapse bg-white rounded shadow"},ft={class:"px-4 py-2 font-semibold"},vt={class:"bg-gray-50"},xt={class:"px-4 py-2 font-semibold"},_t={class:"px-4 py-2 font-semibold"},yt={class:"bg-white p-6 rounded shadow w-full max-w-lg"},gt={class:"text-lg font-semibold mb-4 text-center"},Ct=["value"],wt=["value"],ht=["value"],Vt={class:"flex justify-end space-x-2"},Et=["disabled"],kt={__name:"CostoVariable",props:{proyecto_id:{type:[Number,String],required:!0},recetas:{type:Array,required:!0},registros:{type:Array,required:!0},costosInsumos:{type:Object,default:()=>({})}},setup(k){const u=k,y=Number(u.proyecto_id),g=Object.fromEntries(u.recetas.map(l=>[l.ref,Number(l.precio_venta)||0])),T=Object.fromEntries(u.recetas.map(l=>[l.ref,l.nombre_producto])),$=Object.fromEntries(u.recetas.map(l=>[l.ref,l.presentacion])),C=u.costosInsumos,w=x(""),B=M(()=>{const l=w.value.toLowerCase().trim();return u.registros.filter(e=>{const o=(T[e.ref]||"").toLowerCase();return e.ref.toLowerCase().includes(l)||o.includes(l)})}),i=M(()=>{const l=u.registros.reduce((d,c)=>d+c.unidades_mes,0),e=u.registros.reduce((d,c)=>d+parseFloat(c.total_costo),0),o=u.registros.reduce((d,c)=>d+parseFloat(c.total_venta),0),r=o?Math.round(e/o*100):0;return{unidades:l,prodTotal:e,ventaTotal:o,pctCostoVenta:r,pctMargen:100-r}}),s=P({ref:"",unidad:"",unidades_mes:""}),b=x(!1),p=x(!1),h=x(null);function R(){s.reset(),s.clearErrors(),s.ref="",s.unidad="",s.unidades_mes="",h.value=null,p.value=!1,b.value=!0}function j(l){h.value=l.id,s.ref=l.ref,s.unidad=l.unidad,s.unidades_mes=l.unidades_mes,s.clearErrors(),p.value=!0,b.value=!0}function f(){b.value=!1}function I(){}function O(){const l=C[s.ref]??0,e=g[s.ref]??0,o=s.unidades_mes*l,r=s.unidades_mes*e,d=r?Math.round(o/r*100):0,c=100-d;s.post(route("costovariable.store",{id:y}),{data:{...s,costo_unitario:l,venta_unitario:e,total_costo:o,total_venta:r,pct_costo_venta:d,pct_margen:c,pct_participacion:0},onSuccess:f,onFinish:()=>E.reload({only:["registros"]})})}function L(){const l=C[s.ref]??0,e=g[s.ref]??0,o=s.unidades_mes*l,r=s.unidades_mes*e,d=r?Math.round(o/r*100):0,c=100-d;s.put(route("costovariable.update",{id:y,registro:h.value}),{data:{...s,costo_unitario:l,venta_unitario:e,total_costo:o,total_venta:r,pct_costo_venta:d,pct_margen:c,pct_participacion:0},onSuccess:f,onFinish:()=>E.reload({only:["registros"]})})}function q(l){A.fire({title:"¿Eliminar registro?",text:`"${l.ref}"`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#e3342f",cancelButtonColor:"#6c757d",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"}).then(e=>{e.isConfirmed&&E.delete(route("costovariable.destroy",{id:y,registro:l.id}),{onSuccess:()=>A.fire("Eliminado","","success")})})}return document.addEventListener("keydown",l=>{l.key==="Escape"&&b.value&&f()}),(l,e)=>(m(),D(Q,{title:"Costo Variable"},{header:F(()=>e[5]||(e[5]=[t("div",{class:"text-center"},[t("h1",{class:"text-2xl font-bold"},"PROGRAMA ACTIVATE Y CRECE"),t("h2",{class:"text-lg text-gray-700"},"COSTOS VARIABLES (Estimación de ventas)")],-1)])),default:F(()=>[t("div",H,[t("div",J,[_(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>w.value=o),type:"text",placeholder:"Buscar ",class:"border w-full rounded p-2 flex-grow focus:outline-none focus:ring"},null,512),[[V,w.value]]),t("button",{onClick:R,class:"px-4 py-2 bg-green-600 text-white rounded shadow hover:bg-green-700 transition"}," Crear ")]),t("div",K,[t("table",W,[e[12]||(e[12]=t("thead",{class:"bg-gray-100"},[t("tr",null,[t("th",{class:"px-4 py-2"},"Producto"),t("th",{class:"px-4 py-2"},"Unidad"),t("th",{class:"px-4 py-2"},"Unid. mes"),t("th",{class:"px-4 py-2"},"Costo Unit."),t("th",{class:"px-4 py-2"},"Venta Unit."),t("th",{class:"px-4 py-2"},"Prod/Comp Total"),t("th",{class:"px-4 py-2"},"Venta Total"),t("th",{class:"px-4 py-2"},"%Costo Venta"),t("th",{class:"px-4 py-2"},"%Margen Contr."),t("th",{class:"px-4 py-2"},"%Participación"),t("th",{class:"px-4 py-2"},"Acciones")])],-1)),t("tbody",null,[(m(!0),v(N,null,S(B.value,o=>(m(),v("tr",{key:o.id,class:"border-t hover:bg-gray-50"},[t("td",X,n(o.ref)+" – "+n(a(T)[o.ref]),1),t("td",Z,n(o.unidad||a($)[o.ref]),1),t("td",tt,n(o.unidades_mes),1),t("td",et,"$"+n(Number(o.costo_unitario).toFixed(2)),1),t("td",ot,"$"+n(Number(o.venta_unitario).toFixed(2)),1),t("td",st,"$"+n(Number(o.total_costo).toFixed(2)),1),t("td",lt,"$"+n(Number(o.total_venta).toFixed(2)),1),t("td",nt,n(o.pct_costo_venta)+"%",1),t("td",at,n(o.pct_margen)+"%",1),t("td",rt,n(Number(o.total_venta/i.value.ventaTotal*100).toFixed(0))+"% ",1),t("td",dt,[t("div",it,[t("button",{onClick:r=>j(o),class:"px-3 py-1 bg-yellow-500 text-white rounded hover:bg-yellow-600 text-sm"}," Editar ",8,ut),t("button",{onClick:r=>q(o),class:"px-3 py-1 bg-red-600 text-white rounded hover:bg-red-700 text-sm"}," Eliminar ",8,ct)])])]))),128)),t("tr",pt,[e[6]||(e[6]=t("td",null,"TOTALES",-1)),e[7]||(e[7]=t("td",null,null,-1)),t("td",null,n(i.value.unidades),1),e[8]||(e[8]=t("td",null,null,-1)),e[9]||(e[9]=t("td",null,null,-1)),t("td",null,"$"+n(Number(i.value.prodTotal).toFixed(2)),1),t("td",null,"$"+n(Number(i.value.ventaTotal).toFixed(2)),1),t("td",null,n(i.value.pctCostoVenta)+"%",1),t("td",null,n(i.value.pctMargen)+"%",1),e[10]||(e[10]=t("td",null,"100%",-1)),e[11]||(e[11]=t("td",null,null,-1))])])])])]),t("div",mt,[t("table",bt,[t("tbody",null,[t("tr",null,[e[13]||(e[13]=t("td",{class:"px-4 py-2 font-semibold"}," Margen de Contribución = (Venta Total − Costo Total) ",-1)),t("td",ft," $"+n(Number(i.value.ventaTotal-i.value.prodTotal).toFixed(2)),1)]),t("tr",vt,[e[14]||(e[14]=t("td",{class:"px-4 py-2"}," % de Margen de Contribución = (Margen de Contribución / Venta Total) × 100 ",-1)),t("td",xt,n(i.value.pctMargen)+"% ",1)]),t("tr",null,[e[15]||(e[15]=t("td",{class:"px-4 py-2"}," % de Costo Variable = (Costo Total / Venta Total) × 100 ",-1)),t("td",_t,n(i.value.pctCostoVenta)+"% ",1)])])])]),b.value?(m(),v("div",{key:0,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",onClick:U(f,["self"])},[t("div",yt,[t("h3",gt,n(p.value?"Editar Registro":"Nuevo Registro"),1),t("form",{onSubmit:e[4]||(e[4]=U(o=>p.value?L():O(),["prevent"])),class:"space-y-4"},[t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm"},"REF *",-1)),_(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>a(s).ref=o),onChange:I,required:"",class:"w-full border rounded p-2"},[e[16]||(e[16]=t("option",{disabled:"",value:""},"— Selecciona —",-1)),(m(!0),v(N,null,S(k.recetas,o=>(m(),v("option",{key:o.ref,value:o.ref},n(o.ref)+" – "+n(o.nombre_producto),9,Ct))),128))],544),[[z,a(s).ref]])]),t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm"},"Unidad",-1)),_(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>a(s).unidad=o),placeholder:"Ej: Servicio, 1",class:"w-full border rounded p-2"},null,512),[[V,a(s).unidad]])]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm"},"Unid. mes *",-1)),_(t("input",{"onUpdate:modelValue":e[3]||(e[3]=o=>a(s).unidades_mes=o),type:"number",required:"",class:"w-full border rounded p-2"},null,512),[[V,a(s).unidades_mes]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm"},"Costo Unit.",-1)),t("input",{value:Number(a(C)[a(s).ref]??0).toFixed(2),disabled:"",class:"w-full border rounded p-2 bg-gray-100"},null,8,wt)]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm"},"Venta Unit.",-1)),t("input",{value:Number(a(g)[a(s).ref]??0).toFixed(2),disabled:"",class:"w-full border rounded p-2 bg-gray-100"},null,8,ht)]),t("div",Vt,[t("button",{type:"button",onClick:f,class:"px-4 py-2 bg-gray-200 rounded hover:bg-gray-300"}," Cancelar "),t("button",{type:"submit",disabled:a(s).processing,class:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"},n(a(s).processing?p.value?"Actualizando...":"Guardando...":p.value?"Actualizar":"Guardar"),9,Et)])],32)])])):G("",!0)]),_:1}))}},St=Y(kt,[["__scopeId","data-v-4871ff58"]]);export{St as default};
