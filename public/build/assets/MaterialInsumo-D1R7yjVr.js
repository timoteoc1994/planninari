import{d as g,k as E,x as P,c as R,o as n,w as U,a as t,e as d,f as v,l as u,p as a,F as y,h as w,t as i,j as k,u as l,q as M,Q as S}from"./app-dG6Nd7Y9.js";import{_ as T}from"./AppLayout-Da1CQfCP.js";import{S as h}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const G={class:"py-8 max-w-4xl mx-auto space-y-6"},Q={class:"flex items-center gap-4"},O={key:0},H={class:"text-lg font-semibold text-gray-700 text-center mt-6"},J={class:"overflow-x-auto rounded-xl border-2"},K={class:"w-full bg-white rounded shadow mx-auto"},W={class:"px-4 py-2"},X={class:"px-4 py-2"},Y={class:"px-4 py-2"},Z={class:"px-4 py-2"},ee={class:"px-4 py-2 space-x-2"},te=["onClick"],se=["onClick"],oe={class:"border-t font-semibold bg-gray-200"},le={class:"px-4 py-2"},re={key:1,class:"text-center text-gray-500"},ne={class:"bg-white p-6 rounded shadow w-full max-w-lg"},de=["value"],ie={key:0,class:"text-red-600 text-sm"},ue={class:"flex justify-end space-x-2"},ae=["disabled"],pe={class:"bg-white p-6 rounded shadow w-full max-w-lg"},ce=["value"],be={key:0,class:"text-red-600 text-sm"},me={class:"flex justify-end space-x-2"},fe=["disabled"],xe={__name:"MaterialInsumo",props:{proyecto_id:Number,insumos:Array,recetas:Array},setup(B){const c=B,_=g(""),V=E(()=>{const r=_.value.toLowerCase().trim();return c.insumos.filter(e=>e.ref.toLowerCase().includes(r)||e.ingrediente.toLowerCase().includes(r))}),I=E(()=>{const r={};return V.value.forEach(e=>{r[e.ref]||(r[e.ref]=[]),r[e.ref].push(e)}),Object.entries(r)}),D=E(()=>{const r={};return V.value.forEach(e=>{r[e.ref]=(r[e.ref]||0)+(parseFloat(e.valor_usd)||0)}),r}),s=P({ref:"",ingrediente:"",descripcion:"",peso_g:"",valor_usd:""}),b=g(!1),m=g(!1),C=g(null);function q(){s.reset(),s.clearErrors(),s.ref="",s.ingrediente="",s.descripcion="",s.peso_g="",s.valor_usd="",C.value=null,b.value=!0}function f(){b.value=!1}function F(){s.post(route("materialinsumo.store",{id:c.proyecto_id}),{onSuccess:()=>{f(),S.reload({only:["insumos"]})}})}function j(r){C.value=r.id,s.ref=r.ref,s.ingrediente=r.ingrediente,s.descripcion=r.descripcion,s.peso_g=r.peso_g,s.valor_usd=r.valor_usd,s.clearErrors(),m.value=!0}function x(){m.value=!1,s.reset(),s.clearErrors()}function A(){s.put(route("materialinsumo.update",{id:c.proyecto_id,materialinsumo:C.value}),{onSuccess:()=>{x(),S.reload({only:["insumos"]})}})}function L(r){h.fire({title:"¿Eliminar este insumo?",text:`"${r.ingrediente}"`,icon:"warning",showCancelButton:!0,confirmButtonColor:"#e3342f",cancelButtonColor:"#6c757d",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"}).then(e=>{e.isConfirmed&&S.delete(route("materialinsumo.destroy",{id:c.proyecto_id,materialinsumo:r.id}),{onSuccess:()=>h.fire("Eliminado","El insumo fue eliminado.","success")})})}return document.addEventListener("keydown",r=>{r.key==="Escape"&&(b.value&&f(),m.value&&x())}),(r,e)=>(n(),R(T,{title:"Materiales e Insumos"},{header:U(()=>e[11]||(e[11]=[t("h2",{class:"font-semibold text-xl text-gray-800 text-center"}," Materiales e Insumos – Precio de Compra ",-1)])),default:U(()=>[t("div",G,[t("div",Q,[u(t("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>_.value=o),type:"text",placeholder:"Buscar por REF o ingrediente...",class:"border w-full rounded p-2 flex-grow focus:outline-none focus:ring"},null,512),[[a,_.value]]),t("button",{onClick:q,class:"px-4 py-2 bg-green-600 text-white rounded shadow hover:bg-green-700 transition"}," Crear ")]),I.value.length?(n(),d("div",O,[(n(!0),d(y,null,w(I.value,([o,N])=>(n(),d("div",{key:o,class:"space-y-2"},[t("h3",H," Insumos para "+i(o),1),t("div",J,[t("table",K,[e[16]||(e[16]=t("thead",{class:"bg-gray-100"},[t("tr",null,[t("th",{class:"px-4 py-2"},"Ingrediente"),t("th",{class:"px-4 py-2"},"Descripción"),t("th",{class:"px-4 py-2"},"Peso (g)"),t("th",{class:"px-4 py-2"},"Valor (USD)"),t("th",{class:"px-4 py-2"},"Acciones")])],-1)),t("tbody",null,[(n(!0),d(y,null,w(N,p=>(n(),d("tr",{key:p.id,class:"border-t hover:bg-gray-50"},[t("td",W,i(p.ingrediente),1),t("td",X,i(p.descripcion),1),t("td",Y,i(p.peso_g||"—"),1),t("td",Z,i(p.valor_usd),1),t("td",ee,[t("button",{onClick:$=>j(p),class:"px-2 py-1 bg-yellow-500 text-white rounded hover:bg-yellow-600 text-sm"}," Editar ",8,te),t("button",{onClick:$=>L(p),class:"px-2 py-1 bg-red-600 text-white rounded hover:bg-red-700 text-sm"}," Eliminar ",8,se)])]))),128)),t("tr",oe,[e[12]||(e[12]=t("td",{class:"px-4 py-2 text-left"},"Subtotal:",-1)),e[13]||(e[13]=t("td",null,null,-1)),e[14]||(e[14]=t("td",null,null,-1)),t("td",le,"$"+i(D.value[o].toFixed(2)),1),e[15]||(e[15]=t("td",null,null,-1))])])])])]))),128))])):(n(),d("div",re," No se encontraron insumos. "))]),b.value?(n(),d("div",{key:0,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",onClick:k(f,["self"])},[t("div",ne,[e[23]||(e[23]=t("h3",{class:"text-lg font-semibold mb-4 text-center"},"Nuevo Insumo",-1)),t("form",{onSubmit:k(F,["prevent"]),class:"space-y-4"},[t("div",null,[e[18]||(e[18]=t("label",{class:"block text-sm"},"REF *",-1)),u(t("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>l(s).ref=o),required:"",class:"w-full border rounded p-2"},[e[17]||(e[17]=t("option",{disabled:"",value:""},"— Selecciona —",-1)),(n(!0),d(y,null,w(c.recetas,o=>(n(),d("option",{key:o.ref,value:o.ref},i(o.ref)+" – "+i(o.nombre_producto),9,de))),128))],512),[[M,l(s).ref]]),l(s).errors.ref?(n(),d("p",ie,i(l(s).errors.ref),1)):v("",!0)]),t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm"},"Ingrediente *",-1)),u(t("input",{"onUpdate:modelValue":e[2]||(e[2]=o=>l(s).ingrediente=o),required:"",class:"w-full border rounded p-2"},null,512),[[a,l(s).ingrediente]])]),t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm"},"Descripción",-1)),u(t("textarea",{"onUpdate:modelValue":e[3]||(e[3]=o=>l(s).descripcion=o),class:"w-full border rounded p-2",rows:"2"},null,512),[[a,l(s).descripcion]])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm"},"Peso (g)",-1)),u(t("input",{"onUpdate:modelValue":e[4]||(e[4]=o=>l(s).peso_g=o),type:"number",step:"0.01",class:"w-full border rounded p-2"},null,512),[[a,l(s).peso_g]])]),t("div",null,[e[22]||(e[22]=t("label",{class:"block text-sm"},"Valor (USD) *",-1)),u(t("input",{"onUpdate:modelValue":e[5]||(e[5]=o=>l(s).valor_usd=o),type:"number",step:"0.01",required:"",class:"w-full border rounded p-2"},null,512),[[a,l(s).valor_usd]])]),t("div",ue,[t("button",{type:"button",onClick:f,class:"px-4 py-2 bg-gray-200 rounded hover:bg-gray-300"}," Cancelar "),t("button",{type:"submit",disabled:l(s).processing,class:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"},i(l(s).processing?"Guardando...":"Guardar"),9,ae)])],32)])])):v("",!0),m.value?(n(),d("div",{key:1,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50",onClick:k(x,["self"])},[t("div",pe,[e[30]||(e[30]=t("h3",{class:"text-lg font-semibold mb-4 text-center"},"Editar Insumo",-1)),t("form",{onSubmit:k(A,["prevent"]),class:"space-y-4"},[t("div",null,[e[25]||(e[25]=t("label",{class:"block text-sm"},"REF *",-1)),u(t("select",{"onUpdate:modelValue":e[6]||(e[6]=o=>l(s).ref=o),required:"",class:"w-full border rounded p-2"},[e[24]||(e[24]=t("option",{disabled:"",value:""},"— Selecciona —",-1)),(n(!0),d(y,null,w(c.recetas,o=>(n(),d("option",{key:o.ref,value:o.ref},i(o.ref)+" – "+i(o.nombre_producto),9,ce))),128))],512),[[M,l(s).ref]]),l(s).errors.ref?(n(),d("p",be,i(l(s).errors.ref),1)):v("",!0)]),t("div",null,[e[26]||(e[26]=t("label",{class:"block text-sm"},"Ingrediente *",-1)),u(t("input",{"onUpdate:modelValue":e[7]||(e[7]=o=>l(s).ingrediente=o),required:"",class:"w-full border rounded p-2"},null,512),[[a,l(s).ingrediente]])]),t("div",null,[e[27]||(e[27]=t("label",{class:"block text-sm"},"Descripción",-1)),u(t("textarea",{"onUpdate:modelValue":e[8]||(e[8]=o=>l(s).descripcion=o),class:"w-full border rounded p-2",rows:"2"},null,512),[[a,l(s).descripcion]])]),t("div",null,[e[28]||(e[28]=t("label",{class:"block text-sm"},"Peso (g)",-1)),u(t("input",{"onUpdate:modelValue":e[9]||(e[9]=o=>l(s).peso_g=o),type:"number",step:"0.01",class:"w-full border rounded p-2"},null,512),[[a,l(s).peso_g]])]),t("div",null,[e[29]||(e[29]=t("label",{class:"block text-sm"},"Valor (USD) *",-1)),u(t("input",{"onUpdate:modelValue":e[10]||(e[10]=o=>l(s).valor_usd=o),type:"number",step:"0.01",required:"",class:"w-full border rounded p-2"},null,512),[[a,l(s).valor_usd]])]),t("div",me,[t("button",{type:"button",onClick:x,class:"px-4 py-2 bg-gray-200 rounded hover:bg-gray-300"}," Cancelar "),t("button",{type:"submit",disabled:l(s).processing,class:"px-4 py-2 bg-yellow-500 text-white rounded hover:bg-yellow-600"},i(l(s).processing?"Actualizando...":"Actualizar"),9,fe)])],32)])])):v("",!0)]),_:1}))}},ke=z(xe,[["__scopeId","data-v-bbb0fe8c"]]);export{ke as default};
