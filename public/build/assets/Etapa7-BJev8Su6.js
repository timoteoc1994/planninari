import{d as k,x as D,k as b,c as P,o as a,w as E,a as e,e as d,f as B,F as _,h as w,t as r,j as A,l as p,u as n,q as I,p as y,n as M}from"./app-CMmN75Yt.js";import{_ as j}from"./AppLayout-CYw2QiOb.js";import{S as x}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const F={class:"py-4 sm:py-6 lg:py-8 px-4 sm:px-6 lg:px-8 max-w-7xl mx-auto space-y-6"},L={class:"bg-white rounded-lg shadow overflow-hidden"},T={class:"w-full overflow-x-auto"},O={class:"min-w-full table-auto"},q={class:"divide-y divide-gray-200"},G={class:"px-4 py-3"},H={class:"font-medium"},J={class:"text-gray-500"},K={class:"px-4 py-3"},Q={class:"px-4 py-3"},W={class:"px-4 py-3"},X={class:"px-4 py-3"},Y={class:"px-4 py-3"},Z={class:"flex space-x-2"},ee=["onClick"],se=["onClick"],te={class:"bg-white rounded-lg shadow overflow-hidden mt-6"},oe={class:"w-full overflow-x-auto"},ie={class:"min-w-full table-auto"},re={class:"divide-y divide-gray-200"},ne={class:"px-4 py-3"},le={class:"font-medium"},ae={class:"text-gray-500"},de={class:"px-4 py-3"},ce={class:"px-4 py-3"},ue={class:"px-4 py-3"},pe={class:"px-4 py-3"},me={class:"px-4 py-3"},fe={class:"flex space-x-2"},xe=["onClick"],ge=["onClick"],be={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50"},ye={class:"bg-white rounded-lg w-full max-w-md max-h-[90vh] overflow-y-auto"},ve={class:"p-6"},_e={class:"flex justify-between items-center mb-6"},we={class:"text-lg font-semibold text-gray-900"},he=["value"],Ce={key:0,class:"text-sm text-gray-500 mt-1"},ke={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},Ee={class:"flex flex-col sm:flex-row gap-3 sm:justify-end pt-4"},Be=["disabled"],Ie={__name:"Etapa7",props:{proyecto_id:Number,disponibles:Array,necesarios:Array,inversiones:Array},setup(N){const c=N;console.log("📦 Props iniciales:",c);const u=k(!1),l=k(null),o=D({proyecto_id:c.proyecto_id,tipo_origen:"disponible",recurso_id:null,cantidad:"",precio_unitario:"",clasificacion:"",vida_util:""});console.log("🧾 Form inicial:",o);const S=b(()=>{const i=o.tipo_origen;return c.inversiones.filter(s=>s.tipo_origen===i).filter(s=>l.value===null||s.id!==l.value).filter(s=>s.recurso_id).map(s=>s.recurso_id)}),g=b(()=>{const s=(o.tipo_origen==="disponible"?c.disponibles:c.necesarios).filter(t=>!S.value.includes(t.id));return console.log(`📋 Recursos ${o.tipo_origen}:`,s),s});function U(){console.log("🟢 Abrir NUEVA inversión"),l.value=null,o.reset(),o.tipo_origen="disponible",u.value=!0}function h(i){console.log("✏️ Editar inversión:",i),l.value=i.id,o.tipo_origen=i.tipo_origen,o.recurso_id=i.recurso_id,o.cantidad=i.cantidad,o.precio_unitario=i.precio_unitario,o.clasificacion=i.clasificacion,o.vida_util=i.vida_util,u.value=!0}function V(){const i=l.value?"put":"post",s=l.value?route("etapa7.inversiones.update",l.value):route("etapa7.inversiones.store");console.log("📤 Enviando inversión (form):",o.data()),console.log("🔗 Método:",i.toUpperCase(),"| URL:",s),o[i](s,{onSuccess:()=>{console.log("✅ Éxito al guardar inversión."),u.value=!1,o.reset(),x.fire({icon:"success",title:l.value?"Inversión actualizada correctamente":"Inversión registrada correctamente",showConfirmButton:!1,timer:2e3,timerProgressBar:!0}).then(()=>{window.location.reload()})},onError:t=>{console.error("❌ Error al guardar inversión:",t),x.fire({icon:"error",title:"Ocurrió un problema al guardar la inversión.",showConfirmButton:!1,timer:2500,timerProgressBar:!0})}})}async function C(i){(await x.fire({title:"¿Estás seguro?",text:"Esta acción eliminará la inversión.",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"})).isConfirmed&&(console.log("🗑 Eliminando inversión ID:",i),o.delete(route("etapa7.inversiones.destroy",i),{onSuccess:()=>{console.log("✅ Inversión eliminada"),x.fire({icon:"success",title:"Inversión eliminada correctamente",showConfirmButton:!1,timer:2e3,timerProgressBar:!0})},onError:t=>{console.error("❌ Error al eliminar:",t),x.fire({icon:"error",title:"No se pudo eliminar la inversión.",showConfirmButton:!1,timer:2500,timerProgressBar:!0})}}))}const R=b(()=>{const i=c.inversiones.filter(s=>s.tipo_origen==="disponible");return console.log("📗 Inversiones disponibles:",i),i}),$=b(()=>{const i=c.inversiones.filter(s=>s.tipo_origen==="necesario");return console.log("📘 Inversiones necesarias:",i),i});return(i,s)=>(a(),P(j,{title:"Detalle de Inversión"},{header:E(()=>s[8]||(s[8]=[e("h2",{class:"font-semibold text-xl text-gray-800"},"Detalle de Inversión",-1)])),default:E(()=>[e("div",F,[e("div",{class:"flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4"},[s[10]||(s[10]=e("h3",{class:"text-lg sm:text-xl font-bold text-gray-800"},"Inversiones Registradas",-1)),e("button",{onClick:U,class:"px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-lg shadow-sm transition-colors self-start sm:self-auto"},s[9]||(s[9]=[e("span",{class:"hidden sm:inline"},"Nueva Inversión",-1),e("span",{class:"sm:hidden"},"+ Nuevo",-1)]))]),e("div",L,[s[12]||(s[12]=e("h3",{class:"text-base font-semibold bg-green-50 px-4 py-3 text-green-800"},"Recursos Disponibles",-1)),e("div",T,[e("table",O,[s[11]||(s[11]=e("thead",{class:"bg-gray-50"},[e("tr",{class:"text-left"},[e("th",{class:"px-4 py-3 text-sm font-medium text-gray-900 whitespace-nowrap"},"Recurso"),e("th",{class:"px-4 py-3 text-sm font-medium text-gray-900 whitespace-nowrap"},"Cantidad"),e("th",{class:"px-4 py-3 text-sm font-medium text-gray-900 whitespace-nowrap"},"Precio Unit."),e("th",{class:"px-4 py-3 text-sm font-medium text-gray-900 whitespace-nowrap"},"Clasificación"),e("th",{class:"px-4 py-3 text-sm font-medium text-gray-900 whitespace-nowrap"},"Vida útil"),e("th",{class:"px-4 py-3 text-sm font-medium text-gray-900 whitespace-nowrap"},"Acciones")])],-1)),e("tbody",q,[(a(!0),d(_,null,w(R.value,t=>{var m,f;return a(),d("tr",{key:t.id,class:"hover:bg-gray-50"},[e("td",G,[e("div",H,r(((m=t.recurso)==null?void 0:m.tipo_recurso)||"Recurso no encontrado"),1),e("div",J,r(((f=t.recurso)==null?void 0:f.descripcion)||"Sin descripción"),1)]),e("td",K,r(t.cantidad),1),e("td",Q,"$"+r(t.precio_unitario),1),e("td",W,r(t.clasificacion),1),e("td",X,r(t.vida_util)+" años",1),e("td",Y,[e("div",Z,[e("button",{onClick:v=>h(t),class:"text-blue-600 hover:text-blue-800 font-medium"},"Editar",8,ee),e("button",{onClick:v=>C(t.id),class:"text-red-600 hover:text-red-800 font-medium"},"Eliminar",8,se)])])])}),128))])])])]),e("div",te,[s[14]||(s[14]=e("h3",{class:"text-base font-semibold bg-blue-50 px-4 py-3 text-blue-800"},"Recursos Necesarios",-1)),e("div",oe,[e("table",ie,[s[13]||(s[13]=e("thead",{class:"bg-gray-50"},[e("tr",{class:"text-left"},[e("th",{class:"px-4 py-3 text-sm font-medium text-gray-900 whitespace-nowrap"},"Recurso"),e("th",{class:"px-4 py-3 text-sm font-medium text-gray-900 whitespace-nowrap"},"Cantidad"),e("th",{class:"px-4 py-3 text-sm font-medium text-gray-900 whitespace-nowrap"},"Precio Unit."),e("th",{class:"px-4 py-3 text-sm font-medium text-gray-900 whitespace-nowrap"},"Clasificación"),e("th",{class:"px-4 py-3 text-sm font-medium text-gray-900 whitespace-nowrap"},"Vida útil"),e("th",{class:"px-4 py-3 text-sm font-medium text-gray-900 whitespace-nowrap"},"Acciones")])],-1)),e("tbody",re,[(a(!0),d(_,null,w($.value,t=>{var m,f;return a(),d("tr",{key:t.id,class:"hover:bg-gray-50"},[e("td",ne,[e("div",le,r(((m=t.recurso)==null?void 0:m.tipo_recurso)||"Recurso no encontrado"),1),e("div",ae,r(((f=t.recurso)==null?void 0:f.descripcion)||"Sin descripción"),1)]),e("td",de,r(t.cantidad),1),e("td",ce,"$"+r(t.precio_unitario),1),e("td",ue,r(t.clasificacion),1),e("td",pe,r(t.vida_util)+" años",1),e("td",me,[e("div",fe,[e("button",{onClick:v=>h(t),class:"text-blue-600 hover:text-blue-800 font-medium"},"Editar",8,xe),e("button",{onClick:v=>C(t.id),class:"text-red-600 hover:text-red-800 font-medium"},"Eliminar",8,ge)])])])}),128))])])])]),u.value?(a(),d("div",be,[e("div",ye,[e("div",ve,[e("div",_e,[e("h4",we,r(l.value?"Editar":"Nueva")+" Inversión ",1),e("button",{onClick:s[0]||(s[0]=t=>u.value=!1),class:"text-gray-400 hover:text-gray-600"},s[15]||(s[15]=[e("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),e("form",{onSubmit:A(V,["prevent"]),class:"space-y-4"},[e("div",null,[s[17]||(s[17]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Disponibilidad del recurso ",-1)),p(e("select",{"onUpdate:modelValue":s[1]||(s[1]=t=>n(o).tipo_origen=t),class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"},s[16]||(s[16]=[e("option",{value:"disponible"},"Recursos Disponibles",-1),e("option",{value:"necesario"},"Recursos Necesarios",-1)]),512),[[I,n(o).tipo_origen]])]),e("div",null,[s[19]||(s[19]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Seleccione recurso ",-1)),p(e("select",{"onUpdate:modelValue":s[2]||(s[2]=t=>n(o).recurso_id=t),class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"},[s[18]||(s[18]=e("option",{value:null,disabled:""},"Seleccione...",-1)),(a(!0),d(_,null,w(g.value,t=>(a(),d("option",{key:t.id,value:t.id},r(t.tipo_recurso)+" – "+r(t.descripcion),9,he))),128))],512),[[I,n(o).recurso_id]]),g.value.length===0?(a(),d("p",Ce," No hay recursos "+r(n(o).tipo_origen==="disponible"?"disponibles":"necesarios")+" sin utilizar. ",1)):B("",!0)]),e("div",ke,[e("div",null,[s[20]||(s[20]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Cantidad ",-1)),p(e("input",{type:"number","onUpdate:modelValue":s[3]||(s[3]=t=>n(o).cantidad=t),class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"},null,512),[[y,n(o).cantidad]])]),e("div",null,[s[21]||(s[21]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Precio unitario ",-1)),p(e("input",{type:"number",step:"0.01","onUpdate:modelValue":s[4]||(s[4]=t=>n(o).precio_unitario=t),class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"},null,512),[[y,n(o).precio_unitario]])])]),e("div",null,[s[22]||(s[22]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Clasificación ",-1)),p(e("input",{type:"text","onUpdate:modelValue":s[5]||(s[5]=t=>n(o).clasificacion=t),class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"},null,512),[[y,n(o).clasificacion]])]),e("div",null,[s[23]||(s[23]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"}," Vida útil (años) ",-1)),p(e("input",{type:"number","onUpdate:modelValue":s[6]||(s[6]=t=>n(o).vida_util=t),class:"w-full border border-gray-300 rounded-md px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:border-transparent"},null,512),[[y,n(o).vida_util]])]),e("div",Ee,[e("button",{onClick:s[7]||(s[7]=t=>u.value=!1),type:"button",class:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors"}," Cancelar "),e("button",{type:"submit",class:M(["px-4 py-2 bg-purple-600 hover:bg-purple-700 text-white rounded-md transition-colors",{"opacity-50 cursor-not-allowed":g.value.length===0}]),disabled:g.value.length===0}," Guardar ",10,Be)])],32)])])])):B("",!0)])]),_:1}))}},Re=z(Ie,[["__scopeId","data-v-6d578bb4"]]);export{Re as default};
