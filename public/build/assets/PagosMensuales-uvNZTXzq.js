import{d as b,k as n,x as P,c as j,o as c,w as E,a as t,e as m,f as N,l as v,p as y,F as U,h as G,t as r,j as F,u as i,Q as w}from"./app-dG6Nd7Y9.js";import{_ as I}from"./AppLayout-Da1CQfCP.js";import{S as A}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as z}from"./_plugin-vue_export-helper-DlAUqK2U.js";const q={class:"py-8 max-w-4xl mx-auto space-y-6"},Q={class:"flex items-center gap-4"},R={class:"overflow-x-auto"},J={class:"w-full table-auto border-collapse bg-white rounded shadow"},Y={class:"px-4 py-2"},H={class:"px-4 py-2 text-right"},K={class:"px-4 py-2 space-x-2"},W=["onClick"],X=["onClick"],Z={key:0},tt={class:"border-t font-semibold bg-gray-50"},et={class:"px-4 py-2 text-right"},ot={class:"font-semibold bg-gray-50"},st={class:"px-4 py-2 text-right"},lt={class:"bg-gray-50 font-semibold"},at={class:"px-4 py-2 text-right"},nt={class:"border-t font-semibold bg-gray-200"},rt={class:"px-4 py-2 text-right"},it={class:"bg-white p-6 rounded shadow-lg w-full max-w-md"},ut={class:"text-lg font-semibold mb-4 text-center"},dt={class:"flex justify-end space-x-2 mt-4"},ct=["disabled"],pt={__name:"PagosMensuales",props:{proyecto_id:Number,pagos:{type:Array,default:()=>[]},totalFijos:{type:[Number,String],default:0},totalVariables:{type:[Number,String],default:0},totalSalarios:{type:[Number,String],default:0}},setup(B){const a=B,x=b(""),_=n(()=>{const s=x.value.toLowerCase().trim();return(a.pagos||[]).filter(e=>e.concepto&&e.concepto.toLowerCase().includes(s))}),f=n(()=>(a.pagos||[]).reduce((s,e)=>s+(parseFloat(e.valor)||0),0)),h=n(()=>Number(a.totalFijos)||0),S=n(()=>Number(a.totalSalarios)||0),C=n(()=>Number(a.totalVariables)||0),T=n(()=>h.value+S.value),V=n(()=>T.value+f.value),D=n(()=>h.value+S.value+f.value+C.value),o=P({concepto:"",valor:""}),p=b(!1),u=b(!1),g=b(null);function k(s=null){o.reset(),o.clearErrors(),s?(u.value=!0,g.value=s.id,o.concepto=s.concepto||"",o.valor=Number(s.valor)||0):(u.value=!1,g.value=null),p.value=!0}function d(){p.value=!1,o.reset(),o.clearErrors(),u.value=!1,g.value=null}function L(){o.post(route("pagos-mensuales.store",{id:a.proyecto_id}),{onSuccess:d,onFinish:()=>w.reload({only:["pagos"]})})}function M(){o.put(route("pagos-mensuales.update",{id:a.proyecto_id,pago_mensual:g.value}),{onSuccess:d,onFinish:()=>w.reload({only:["pagos"]})})}function $(s){A.fire({title:"¿Eliminar pago?",text:s.concepto||"Pago sin nombre",icon:"warning",showCancelButton:!0,confirmButtonColor:"#e3342f",cancelButtonColor:"#6c757d",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"}).then(e=>{e.isConfirmed&&w.delete(route("pagos-mensuales.destroy",{id:a.proyecto_id,pago_mensual:s.id}),{onSuccess:()=>A.fire("Eliminado","","success")})})}return document.addEventListener("keydown",s=>{s.key==="Escape"&&p.value&&d()}),(s,e)=>(c(),j(I,{title:"Pagos Mensuales de Deudas"},{header:E(()=>e[5]||(e[5]=[t("h2",{class:"text-center text-2xl font-bold"},"Pagos mensuales de deudas (Negocio y personal)",-1)])),default:E(()=>[t("div",q,[t("div",Q,[v(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>x.value=l),type:"text",placeholder:"Buscar por concepto...",class:"border w-full rounded p-2 focus:outline-none focus:ring"},null,512),[[y,x.value]]),t("button",{onClick:e[1]||(e[1]=l=>k()),class:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition"}," Crear ")]),t("div",R,[t("table",J,[e[15]||(e[15]=t("thead",{class:"bg-gray-100"},[t("tr",null,[t("th",{class:"px-4 py-2 text-left"},"Concepto"),t("th",{class:"px-4 py-2 text-right"},"Valor (USD)"),t("th",{class:"px-4 py-2 text-left"},"Acciones")])],-1)),t("tbody",null,[(c(!0),m(U,null,G(_.value,l=>(c(),m("tr",{key:l.id,class:"border-t hover:bg-gray-50"},[t("td",Y,r(l.concepto),1),t("td",H," $"+r(Number(l.valor||0).toFixed(2)),1),t("td",K,[t("button",{onClick:O=>k(l),class:"px-2 py-1 bg-yellow-500 text-white rounded hover:bg-yellow-600 text-sm"}," Editar ",8,W),t("button",{onClick:O=>$(l),class:"px-2 py-1 bg-red-600 text-white rounded hover:bg-red-700 text-sm"}," Eliminar ",8,X)])]))),128)),_.value.length?N("",!0):(c(),m("tr",Z,e[6]||(e[6]=[t("td",{colspan:"3",class:"text-center py-8 text-gray-500"}," No hay pagos mensuales. ",-1)]))),t("tr",tt,[e[7]||(e[7]=t("td",{class:"px-4 py-2"},"TOTAL PAGOS DEUDAS",-1)),t("td",et," $"+r(f.value.toFixed(2)),1),e[8]||(e[8]=t("td",null,null,-1))]),t("tr",ot,[e[9]||(e[9]=t("td",{class:"px-4 py-2"},"TOTAL COSTOS FIJOS MENSUALES Y DEUDAS",-1)),t("td",st," $"+r(V.value.toFixed(2)),1),e[10]||(e[10]=t("td",null,null,-1))]),t("tr",lt,[e[11]||(e[11]=t("td",{class:"px-4 py-2"},"COSTOS VARIABLES",-1)),t("td",at," $"+r(C.value.toFixed(2)),1),e[12]||(e[12]=t("td",null,null,-1))]),t("tr",nt,[e[13]||(e[13]=t("td",{class:"px-4 py-2"},"TOTAL GENERAL",-1)),t("td",rt," $"+r(D.value.toFixed(2)),1),e[14]||(e[14]=t("td",null,null,-1))])])])])]),p.value?(c(),m("div",{key:0,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",onClick:F(d,["self"])},[t("div",it,[t("h3",ut,r(u.value?"Editar pago":"Nuevo pago"),1),t("form",{onSubmit:e[4]||(e[4]=F(l=>u.value?M():L(),["prevent"])),class:"space-y-4"},[t("div",null,[e[16]||(e[16]=t("label",{class:"block text-sm mb-1"},"Concepto *",-1)),v(t("input",{"onUpdate:modelValue":e[2]||(e[2]=l=>i(o).concepto=l),type:"text",required:"",class:"w-full border rounded p-2"},null,512),[[y,i(o).concepto]])]),t("div",null,[e[17]||(e[17]=t("label",{class:"block text-sm mb-1"},"Valor (USD) *",-1)),v(t("input",{"onUpdate:modelValue":e[3]||(e[3]=l=>i(o).valor=l),type:"number",step:"0.01",required:"",class:"w-full border rounded p-2 text-right"},null,512),[[y,i(o).valor,void 0,{number:!0}]])]),t("div",dt,[t("button",{type:"button",onClick:d,class:"px-4 py-2 bg-gray-200 rounded hover:bg-gray-300"}," Cancelar "),t("button",{type:"submit",disabled:i(o).processing,class:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"},r(u.value?i(o).processing?"Actualizando…":"Actualizar":i(o).processing?"Guardando…":"Guardar"),9,ct)])],32)])])):N("",!0)]),_:1}))}},ft=z(pt,[["__scopeId","data-v-a227fb26"]]);export{ft as default};
