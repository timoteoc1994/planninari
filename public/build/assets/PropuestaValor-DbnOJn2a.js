import{x as A,d as N,k as x,c as U,o as l,w as y,a as t,j as c,e as n,f as h,l as w,u as d,p as _,F as k,h as E,g as j,t as B,Q as S}from"./app-dG6Nd7Y9.js";import{_ as F}from"./AppLayout-Da1CQfCP.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const L={class:"py-12"},T={class:"max-w-4xl mx-auto sm:px-6 lg:px-8 bg-white p-8 rounded shadow"},z={class:"mb-4"},O={class:"mb-4"},M={key:0,class:"mb-4"},Q={class:"flex flex-wrap gap-2"},R=["src","alt"],W=["onClick"],G={class:"mb-4"},H={key:0,class:"mt-2 flex flex-wrap gap-2"},J=["src"],K=["onClick"],X={type:"submit",class:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700"},te={__name:"PropuestaValor",props:{proyecto_id:Number,propuestavalor:Object},setup(C){var v,b;const o=C,a=A({propuestavalor:((v=o.propuestavalor)==null?void 0:v.propuestavalor)??"",caracteristicas:((b=o.propuestavalor)==null?void 0:b.caracteristicas)??"",proyecto_id:o.proyecto_id,imagenes:[]}),i=N([]),p=x(()=>{var s;if(!((s=o.propuestavalor)!=null&&s.imagenes))return[];try{return JSON.parse(o.propuestavalor.imagenes).map(r=>({url:`/storage/${r}`,ruta:r}))}catch(e){return console.error("Error parsing imagenes:",e),[]}});function D(s){const e=Array.from(s.target.files).filter(r=>r.type.startsWith("image/"));a.imagenes=[...a.imagenes,...e],m()}function I(s){s.preventDefault();const e=Array.from(s.dataTransfer.files).filter(r=>r.type.startsWith("image/"));a.imagenes=[...a.imagenes,...e],m()}function m(){i.value=a.imagenes.map(s=>({url:URL.createObjectURL(s),name:s.name}))}function q(s){a.imagenes.splice(s,1),m()}function P(s){const e=p.value[s];confirm("¿Estás seguro de que quieres eliminar esta imagen?")&&S.delete(route("propuestavalor.eliminar.imagen",o.proyecto_id),{data:{ruta_imagen:e.ruta},onSuccess:()=>{S.reload({only:["propuestavalor"]})},onError:r=>{console.error("Error al eliminar imagen:",r),alert("Error al eliminar la imagen")}})}const f=x(()=>!!o.propuestavalor);function $(){f.value?a.post(route("propuestavalor.update",o.propuestavalor.id),{forceFormData:!0,onStart:()=>console.log("Enviando..."),onSuccess:()=>{console.log("¡Listo!"),g()},data:{_method:"PUT"}}):a.post(route("propuestavalor.store"),{forceFormData:!0,onSuccess:()=>{g()}})}function g(){a.imagenes=[],i.value=[],document.querySelector('input[type="file"]')&&(document.querySelector('input[type="file"]').value="")}return(s,e)=>(l(),U(F,{title:"Propuesta de valor"},{header:y(()=>e[4]||(e[4]=[t("div",{class:"flex justify-between items-center"},[t("h2",{class:"font-semibold text-xl text-gray-800 leading-tight"}," Propuesta de valor ")],-1)])),default:y(()=>[t("div",L,[t("div",T,[t("form",{onSubmit:c($,["prevent"])},[t("div",z,[e[5]||(e[5]=t("label",{class:"block mb-1 font-semibold"},"Problema",-1)),w(t("textarea",{"onUpdate:modelValue":e[0]||(e[0]=r=>d(a).propuestavalor=r),class:"w-full border rounded px-3 py-2",required:""},null,512),[[_,d(a).propuestavalor]])]),t("div",O,[e[6]||(e[6]=t("label",{class:"block mb-1 font-semibold"},"Solución",-1)),w(t("textarea",{"onUpdate:modelValue":e[1]||(e[1]=r=>d(a).caracteristicas=r),class:"w-full border rounded px-3 py-2",required:""},null,512),[[_,d(a).caracteristicas]])]),p.value.length?(l(),n("div",M,[e[7]||(e[7]=t("label",{class:"block mb-1 font-semibold"},"Imágenes actuales",-1)),t("div",Q,[(l(!0),n(k,null,E(p.value,(r,u)=>(l(),n("div",{key:r.ruta,class:"relative w-20 h-20 overflow-hidden rounded border bg-gray-100 flex items-center justify-center"},[t("img",{src:r.url,class:"object-cover w-full h-full",alt:`Imagen ${u+1}`},null,8,R),t("button",{type:"button",onClick:c(V=>P(u),["stop"]),class:"absolute top-1 right-1 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs hover:bg-red-600",title:"Eliminar imagen existente"}," × ",8,W)]))),128))])])):h("",!0),t("div",G,[e[9]||(e[9]=t("label",{class:"block mb-1 font-semibold"},"Añadir nuevas imágenes",-1)),t("div",{class:"w-full border-2 border-dashed rounded px-3 py-6 text-center cursor-pointer hover:bg-gray-50",onClick:e[2]||(e[2]=r=>s.$refs.inputImagenes.click()),onDragover:e[3]||(e[3]=c(()=>{},["prevent"])),onDrop:I},[t("input",{type:"file",multiple:"",accept:"image/*",onChange:D,class:"hidden",ref:"inputImagenes"},null,544),e[8]||(e[8]=t("span",{class:"block text-gray-600"},[j("Haz clic o arrastra "),t("b",null,"solo imágenes"),j(" aquí")],-1))],32),i.value.length?(l(),n("div",H,[(l(!0),n(k,null,E(i.value,(r,u)=>(l(),n("div",{key:r.url,class:"relative w-20 h-20 overflow-hidden rounded border bg-gray-100 flex items-center justify-center"},[t("img",{src:r.url,class:"object-cover w-full h-full"},null,8,J),t("button",{type:"button",onClick:c(V=>q(u),["stop"]),class:"absolute top-1 right-1 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs hover:bg-red-600",title:"Eliminar nueva imagen"}," × ",8,K)]))),128))])):h("",!0)]),t("button",X,B(f.value?"Actualizar":"Guardar"),1)],32)])])]),_:1}))}};export{te as default};
