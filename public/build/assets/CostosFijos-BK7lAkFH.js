import{d as p,k as m,x as M,c as T,o as u,w as C,a as t,e as f,f as j,l as v,p as y,F as V,h as $,t as a,j as S,u as n,Q as g}from"./app-dG6Nd7Y9.js";import{_ as O}from"./AppLayout-Da1CQfCP.js";import{S as k}from"./sweetalert2.esm.all-BQIkj5Wb.js";import{_ as U}from"./_plugin-vue_export-helper-DlAUqK2U.js";const D={class:"py-8 max-w-4xl mx-auto space-y-6"},I={class:"flex items-center gap-4"},z={class:"overflow-x-auto"},q={class:"w-full table-auto border-collapse bg-white rounded shadow"},G={class:"px-4 py-2"},Q={class:"px-4 py-2 text-right"},J={class:"px-4 py-2 space-x-2"},R=["onClick"],H=["onClick"],K={key:0},P={class:"border-t font-semibold bg-gray-50"},W={class:"px-4 py-2 text-right"},X={class:"border-t font-semibold bg-gray-200"},Y={class:"px-4 py-2 text-right"},Z={class:"bg-white p-6 rounded shadow-lg w-full max-w-md"},tt={class:"text-lg font-semibold mb-4 text-center"},ot={class:"flex justify-end space-x-2 mt-4"},et=["disabled"],st={__name:"CostosFijos",props:{proyecto_id:Number,costosFijos:Array,totalVariables:[Number,String],totalSalarios:[Number,String]},setup(F){const r=F,b=p(""),h=m(()=>{const e=b.value.toLowerCase().trim();return r.costosFijos.filter(o=>o.concepto.toLowerCase().includes(e))}),N=m(()=>r.costosFijos.reduce((e,o)=>e+parseFloat(o.valor),0)),w=m(()=>Number(r.totalSalarios)||0),s=M({concepto:"",valor:""}),c=p(!1),i=p(!1),x=p(null);function _(e=null){s.reset(),s.clearErrors(),e?(i.value=!0,x.value=e.id,s.concepto=e.concepto,s.valor=Number(e.valor)):(i.value=!1,x.value=null),c.value=!0}function d(){c.value=!1}function E(){s.post(route("costos-fijos.store",{id:r.proyecto_id}),{onSuccess:d,onFinish:()=>g.reload({only:["costosFijos"]})})}function B(){s.put(route("costos-fijos.update",{id:r.proyecto_id,costo_fijo:x.value}),{onSuccess:d,onFinish:()=>g.reload({only:["costosFijos"]})})}function A(e){k.fire({title:"¿Eliminar costo fijo?",text:e.concepto,icon:"warning",showCancelButton:!0,confirmButtonColor:"#e3342f",cancelButtonColor:"#6c757d",confirmButtonText:"Sí, eliminar",cancelButtonText:"Cancelar"}).then(o=>{o.isConfirmed&&g.delete(route("costos-fijos.destroy",{id:r.proyecto_id,costo_fijo:e.id}),{onSuccess:()=>k.fire("Eliminado","","success")})})}return document.addEventListener("keydown",e=>{e.key==="Escape"&&c.value&&d()}),(e,o)=>(u(),T(O,{title:"Costos Fijos Mensuales"},{header:C(()=>o[5]||(o[5]=[t("h2",{class:"text-center text-2xl font-bold"},"Costos Fijos Mensuales",-1)])),default:C(()=>[t("div",D,[t("div",I,[v(t("input",{"onUpdate:modelValue":o[0]||(o[0]=l=>b.value=l),type:"text",placeholder:"Buscar por concepto...",class:"border w-full rounded p-2 focus:outline-none focus:ring"},null,512),[[y,b.value]]),t("button",{onClick:o[1]||(o[1]=l=>_()),class:"px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700 transition"}," + Nuevo costo ")]),t("div",z,[t("table",q,[o[11]||(o[11]=t("thead",{class:"bg-gray-100"},[t("tr",null,[t("th",{class:"px-4 py-2 text-left"},"Concepto"),t("th",{class:"px-4 py-2 text-right"},"Valor (USD)"),t("th",{class:"px-4 py-2 text-left"},"Acciones")])],-1)),t("tbody",null,[(u(!0),f(V,null,$(h.value,l=>(u(),f("tr",{key:l.id,class:"border-t hover:bg-gray-50"},[t("td",G,a(l.concepto),1),t("td",Q," $"+a(Number(l.valor).toFixed(2)),1),t("td",J,[t("button",{onClick:L=>_(l),class:"px-2 py-1 bg-yellow-500 text-white rounded hover:bg-yellow-600 text-sm"},"Editar",8,R),t("button",{onClick:L=>A(l),class:"px-2 py-1 bg-red-600 text-white rounded hover:bg-red-700 text-sm"},"Eliminar",8,H)])]))),128)),h.value.length?j("",!0):(u(),f("tr",K,o[6]||(o[6]=[t("td",{colspan:"3",class:"text-center py-8 text-gray-500"}," No hay costos fijos. ",-1)]))),t("tr",P,[o[7]||(o[7]=t("td",{class:"px-4 py-2"},"TOTAL SALARIOS",-1)),t("td",W," $"+a(w.value.toFixed(2)),1),o[8]||(o[8]=t("td",null,null,-1))]),t("tr",X,[o[9]||(o[9]=t("td",{class:"px-4 py-2"},"TOTAL COSTOS FIJOS MENSUALES",-1)),t("td",Y," $"+a((N.value+w.value).toFixed(2)),1),o[10]||(o[10]=t("td",null,null,-1))])])])])]),c.value?(u(),f("div",{key:0,class:"fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50",onClick:S(d,["self"])},[t("div",Z,[t("h3",tt,a(i.value?"Editar costo fijo":"Nuevo costo fijo"),1),t("form",{onSubmit:o[4]||(o[4]=S(l=>i.value?B():E(),["prevent"])),class:"space-y-4"},[t("div",null,[o[12]||(o[12]=t("label",{class:"block text-sm mb-1"},"Concepto *",-1)),v(t("input",{"onUpdate:modelValue":o[2]||(o[2]=l=>n(s).concepto=l),type:"text",required:"",class:"w-full border rounded p-2"},null,512),[[y,n(s).concepto]])]),t("div",null,[o[13]||(o[13]=t("label",{class:"block text-sm mb-1"},"Valor (USD) *",-1)),v(t("input",{"onUpdate:modelValue":o[3]||(o[3]=l=>n(s).valor=l),type:"number",step:"0.01",required:"",class:"w-full border rounded p-2 text-right"},null,512),[[y,n(s).valor,void 0,{number:!0}]])]),t("div",ot,[t("button",{type:"button",onClick:d,class:"px-4 py-2 bg-gray-200 rounded hover:bg-gray-300"},"Cancelar"),t("button",{type:"submit",disabled:n(s).processing,class:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"},a(i.value?n(s).processing?"Actualizando…":"Actualizar":n(s).processing?"Guardando…":"Guardar"),9,et)])],32)])])):j("",!0)]),_:1}))}},it=U(st,[["__scopeId","data-v-0fdcfa62"]]);export{it as default};
